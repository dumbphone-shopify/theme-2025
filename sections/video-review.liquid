{% schema %}
    {
      "name": "Product video review",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Video review"
        },
        {
          "type": "checkbox",
          "id": "show_description",
          "label": "Show product description",
          "default": true
        }
      ]
    }
    {% endschema %}
    
    <style>
    .responsive-video {
      aspect-ratio: 16 / 9;
      width: 100%;
      height: auto;
      display: block;
      margin-bottom: 1.5rem;
    }
    </style>
    
    <div class="product-video-review">
      {% if section.settings.heading != blank %}
        <h2>{{ section.settings.heading }}</h2>
      {% endif %}
    
      {% assign hero_video_url = product.metafields.custom.video_feature.value %}
      {% assign embed_url = '' %}
      {% if hero_video_url %}
        {% if hero_video_url contains 'youtube.com/watch?v=' %}
          {% assign video_id = hero_video_url | split: 'v=' | last | split: '&' | first %}
          {% assign embed_url = 'https://www.youtube.com/embed/' | append: video_id %}
        {% elsif hero_video_url contains 'youtu.be/' %}
          {% assign video_id = hero_video_url | split: 'youtu.be/' | last | split: '?' | first %}
          {% assign embed_url = 'https://www.youtube.com/embed/' | append: video_id %}
        {% elsif hero_video_url contains 'vimeo.com/' %}
          {% assign video_id = hero_video_url | split: 'vimeo.com/' | last | split: '?' | first %}
          {% assign embed_url = 'https://player.vimeo.com/video/' | append: video_id %}
        {% else %}
          {% assign embed_url = hero_video_url %}
        {% endif %}
        <div class="responsive-video">
          <iframe src="{{ embed_url }}" frameborder="0" allowfullscreen style="width:100%;height:100%"></iframe>
        </div>
      {% else %}
        <p>No video review available for this product.</p>
      {% endif %}
    
      {% if section.settings.show_description %}
        <div class="product-description">
          {{ product.metafields.custom.secondary_description.value | metafield_tag }}
        </div>
      {% endif %}
    </div>